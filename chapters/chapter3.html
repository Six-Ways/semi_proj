<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬¬3ç« ï¼šåŠå¯¼ä½“å™¨ä»¶åŸºç¡€ - SEMI_PROJ</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="../css/chapter-styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    <header class="header">
        <div class="container">
            <a href="../index.html" class="logo">
                <h1>SEMI_PROJ</h1>
                <p>åŠå¯¼ä½“å™¨ä»¶ä¸åˆ¶é€ æŠ€æœ¯äº¤äº’å¼æŒ‡å—</p>
            </a>
            <nav class="main-nav">
                <ul>
                    <li><a href="../index.html" class="nav-link">é¦–é¡µ</a></li>
                    <li><a href="../index.html#part1" class="nav-link">ç¬¬ä¸€éƒ¨åˆ†</a></li>
                    <li><a href="../index.html#part2" class="nav-link">ç¬¬äºŒéƒ¨åˆ†</a></li>
                    <li><a href="../index.html#part3" class="nav-link">ç¬¬ä¸‰éƒ¨åˆ†</a></li>
                    <li><a href="../index.html#part4" class="nav-link">ç¬¬å››éƒ¨åˆ†</a></li>
                </ul>
            </nav>
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
    </header>
    
    <!-- å·¦ä¾§èœå•ç›®å½• -->
    <aside class="sidebar">
        <button class="sidebar-toggle">
            <i class="fas fa-chevron-left"></i>
        </button>
        
        <div class="sidebar-content">
            <div class="sidebar-header">
                <h3>ç« èŠ‚å¯¼èˆª</h3>
                <button class="sidebar-hide-btn" title="éšè—ä¾§è¾¹æ ">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <nav class="chapter-nav">
                <a href="../index.html" class="chapter-nav-item">
                    <i class="fas fa-home"></i> è¿”å›ä¸»é¡µ
                </a>
                
                <a href="chapter1.html" class="chapter-nav-item ">
                    ç¬¬1ç« ï¼šåŠå¯¼ä½“è¡Œä¸šä¸æŠ€æœ¯æ¼”è¿›
                </a>
                <a href="chapter2.html" class="chapter-nav-item ">
                    ç¬¬2ç« ï¼šåŠå¯¼ä½“ææ–™åŸºç¡€
                </a>
                <a href="chapter3.html" class="chapter-nav-item active">
                    ç¬¬3ç« ï¼šåŸºç¡€åŠå¯¼ä½“å™¨ä»¶
                </a>
                <a href="chapter4.html" class="chapter-nav-item ">
                    ç¬¬4ç« ï¼šMOSFETæ ¸å¿ƒæŠ€æœ¯
                </a>
                <a href="chapter5.html" class="chapter-nav-item ">
                    ç¬¬5ç« ï¼šæ•°å­—é›†æˆå™¨ä»¶
                </a>
                <a href="chapter6.html" class="chapter-nav-item ">
                    ç¬¬6ç« ï¼šæ¨¡æ‹Ÿé›†æˆå™¨ä»¶
                </a>
                <a href="chapter7.html" class="chapter-nav-item ">
                    ç¬¬7ç« ï¼šç‰¹æ®ŠåŠŸèƒ½å™¨ä»¶
                </a>
                <a href="chapter8.html" class="chapter-nav-item ">
                    ç¬¬8ç« ï¼šè¡¬åº•ä¸æ™¶åœ†åˆ¶å¤‡
                </a>
                <a href="chapter9.html" class="chapter-nav-item ">
                    ç¬¬9ç« ï¼šå™¨ä»¶å›¾å½¢åŒ–å·¥è‰º
                </a>
                <a href="chapter10.html" class="chapter-nav-item ">
                    ç¬¬10ç« ï¼šå™¨ä»¶æºæ‚ä¸è–„è†œå·¥è‰º
                </a>
                <a href="chapter11.html" class="chapter-nav-item ">
                    ç¬¬11ç« ï¼šå™¨ä»¶äº’è¿ä¸å°è£…
                </a>
                <a href="chapter12.html" class="chapter-nav-item ">
                    ç¬¬12ç« ï¼šçº³ç±³å°ºåº¦å™¨ä»¶æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ
                </a>
                <a href="chapter13.html" class="chapter-nav-item ">
                    ç¬¬13ç« ï¼šå®½ç¦å¸¦åŠå¯¼ä½“å™¨ä»¶
                </a>
                <a href="chapter14.html" class="chapter-nav-item ">
                    ç¬¬14ç« ï¼šåæ‘©å°”æ—¶ä»£å™¨ä»¶æŠ€æœ¯
                </a>
                <a href="chapter15.html" class="chapter-nav-item ">
                    ç¬¬15ç« ï¼šå™¨ä»¶è®¾è®¡ä¸ä»¿çœŸå·¥å…·
                </a>
                <a href="chapter16.html" class="chapter-nav-item ">
                    ç¬¬16ç« ï¼šæ•…éšœæ’æŸ¥ä¸æµ‹è¯•æŠ€æœ¯
                </a>
                <a href="chapter17.html" class="chapter-nav-item ">
                    ç¬¬17ç« ï¼šè¡Œä¸šèµ„æºæ±‡æ€»
                </a>
            </nav>
            
            
                <div class="current-chapter-nav">
                    <h4>å½“å‰ç« èŠ‚</h4>
                    <nav class="section-nav">

                    <a href="#pn-junction" class="section-nav-item">
                        PNç»“åŸç†
                    </a>
                    <a href="#diode-characteristics" class="section-nav-item">
                        äºŒæç®¡ç‰¹æ€§
                    </a>
                    <a href="#bjt-basics" class="section-nav-item">
                        BJTåŸºç¡€
                    </a>
                    <a href="#chapter-summary" class="section-nav-item">
                        æœ¬ç« å°ç»“
                    </a>
                    </nav>
                </div>
        </div>
    </aside>
    

    <main class="main-content">
        <div class="chapter-container">
            <div class="breadcrumb">
                <p><a href="../index.html">é¦–é¡µ</a> &gt; <a href="../index.html#basics">åŸºç¡€åŸç†</a> &gt; ç¬¬3ç« ï¼šåŠå¯¼ä½“å™¨ä»¶åŸºç¡€</p>
            </div>
        <div class="chapter-header">
            <h1>ç¬¬3ç« ï¼šåŠå¯¼ä½“å™¨ä»¶åŸºç¡€</h1>
        </div>
        
        <div class="chapter-core">
            <h3>æœ¬ç« æ ¸å¿ƒ</h3>
            <p>åŠå¯¼ä½“å™¨ä»¶æ˜¯ç°ä»£ç”µå­æŠ€æœ¯çš„æ ¸å¿ƒç»„ä»¶ï¼Œç†è§£å…¶å·¥ä½œåŸç†å¯¹äºæŒæ¡ç”µå­ç³»ç»Ÿè‡³å…³é‡è¦ã€‚æœ¬ç« å°†æ·±å…¥æ¢è®¨PNç»“çš„å½¢æˆæœºç†ã€äºŒæç®¡çš„æ•´æµç‰¹æ€§ä»¥åŠæ™¶ä½“ç®¡çš„æ”¾å¤§ä½œç”¨ï¼Œé€šè¿‡äº¤äº’å¼æ¨¡æ‹Ÿå™¨å¸®åŠ©æ‚¨ç›´è§‚ç†è§£å™¨ä»¶å†…éƒ¨è½½æµå­çš„è¿åŠ¨è§„å¾‹å’Œç”µå­¦ç‰¹æ€§ã€‚</p>
        </div>
        
        <!-- PNç»“æ¨¡æ‹Ÿå™¨ -->
        <div class="pn-junction-simulator">
            <h2>âš›ï¸ PNç»“æ¨¡æ‹Ÿå™¨ï¼šæ¢ç´¢ç»“çš„å½¢æˆä¸ç‰¹æ€§ <span class="progress-indicator" id="junction-progress">0/0</span></h2>
            <p>é€šè¿‡è°ƒæ•´æºæ‚æµ“åº¦å’Œåç½®ç”µå‹ï¼Œè§‚å¯ŸPNç»“å†…éƒ¨è½½æµå­åˆ†å¸ƒå’Œç”µåœºå˜åŒ–ã€‚</p>
            
            <div class="simulator-container">
                <div class="junction-visualization" id="junction-viz">
                    <div class="junction-region p-region">PåŒº</div>
                    <div class="junction-region n-region">NåŒº</div>
                    <div class="depletion-region" id="depletion-region"></div>
                    <!-- åŠ¨æ€ç”Ÿæˆçš„è½½æµå­ -->
                </div>
                
                <div class="controls-panel">
                    <div class="control-group">
                        <label class="control-label">PåŒºæºæ‚æµ“åº¦</label>
                        <div class="slider-container">
                            <input type="range" class="slider" id="p-doping" min="15" max="18" value="16" step="0.1" oninput="updateJunction()">
                            <span class="slider-value" id="p-doping-value">10Â¹â¶ cmâ»Â³</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">NåŒºæºæ‚æµ“åº¦</label>
                        <div class="slider-container">
                            <input type="range" class="slider" id="n-doping" min="15" max="18" value="16" step="0.1" oninput="updateJunction()">
                            <span class="slider-value" id="n-doping-value">10Â¹â¶ cmâ»Â³</span>
                        </div>
                    </div>
                    
                    <div class="control-group">
                        <label class="control-label">åç½®ç”µå‹</label>
                        <div class="slider-container">
                            <input type="range" class="slider" id="bias-voltage" min="-2" max="2" value="0" step="0.1" oninput="updateJunction()">
                            <span class="slider-value" id="bias-voltage-value">0.0 V</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="results-panel">
                <h3>PNç»“ç‰¹æ€§</h3>
                <div class="result-item">
                    <span class="result-label">è€—å°½åŒºå®½åº¦</span>
                    <span class="result-value" id="depletion-width">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">å†…å»ºç”µåŠ¿</span>
                    <span class="result-value" id="built-in-potential">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ç»“ç”µå®¹</span>
                    <span class="result-value" id="junction-capacitance">-</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ç»“ç”µæµ</span>
                    <span class="result-value" id="junction-current">-</span>
                </div>
            </div>
        </div>
        
        <!-- å™¨ä»¶å®éªŒå®¤ -->
        <div class="device-lab">
            <h2>ğŸ”¬ å™¨ä»¶å®éªŒå®¤ï¼šæµ‹è¯•åŠå¯¼ä½“å™¨ä»¶ç‰¹æ€§ <span class="progress-indicator" id="device-progress">0/0</span></h2>
            <p>é€‰æ‹©ä¸åŒçš„åŠå¯¼ä½“å™¨ä»¶ï¼Œæ­å»ºæµ‹è¯•ç”µè·¯ï¼Œè§‚å¯Ÿå™¨ä»¶çš„ç”µå­¦ç‰¹æ€§æ›²çº¿ã€‚</p>
            
            <div class="device-selector">
                <div class="device-card" onclick="selectDevice('diode')">
                    <div class="device-icon">âš¡</div>
                    <div class="device-name">äºŒæç®¡</div>
                    <div class="device-description">å•å‘å¯¼ç”µå™¨ä»¶ï¼Œç”¨äºæ•´æµå’Œæ£€æ³¢</div>
                </div>
                
                <div class="device-card" onclick="selectDevice('bjt')">
                    <div class="device-icon">ğŸ”§</div>
                    <div class="device-name">åŒææ™¶ä½“ç®¡</div>
                    <div class="device-description">ç”µæµæ§åˆ¶å™¨ä»¶ï¼Œç”¨äºä¿¡å·æ”¾å¤§</div>
                </div>
                
                <div class="device-card" onclick="selectDevice('mosfet')">
                    <div class="device-icon">ğŸ’»</div>
                    <div class="device-name">MOSFET</div>
                    <div class="device-description">ç”µå‹æ§åˆ¶å™¨ä»¶ï¼Œç”¨äºå¼€å…³å’Œæ”¾å¤§</div>
                </div>
            </div>
            
            <div class="device-test-area" id="device-test-area">
                <div class="test-circuit" id="test-circuit">
                    <div class="circuit-element voltage-source">V</div>
                    <div class="wire"></div>
                    <div class="circuit-element resistor" id="test-device"></div>
                    <div class="wire"></div>
                    <div class="circuit-element voltage-source">GND</div>
                </div>
                
                <div class="measurement-display">
                    <div class="measurement-item">
                        <span class="measurement-label">ç”µå‹</span>
                        <span class="measurement-value" id="voltage-value">0.0 V</span>
                    </div>
                    <div class="measurement-item">
                        <span class="measurement-label">ç”µæµ</span>
                        <span class="measurement-value" id="current-value">0.0 mA</span>
                    </div>
                    <div class="measurement-item">
                        <span class="measurement-label">åŠŸç‡</span>
                        <span class="measurement-value" id="power-value">0.0 mW</span>
                    </div>
                </div>
                
                <div class="iv-curve">
                    <canvas id="iv-chart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- ç« èŠ‚æ€»ç»“ -->
        <div class="section">
            <h3>æœ¬ç« å°ç»“</h3>
            <div class="subsection">
                <p>PNç»“æ˜¯åŠå¯¼ä½“å™¨ä»¶çš„åŸºç¡€ç»“æ„ï¼Œé€šè¿‡På‹å’ŒNå‹åŠå¯¼ä½“çš„ç»“åˆå½¢æˆå†…å»ºç”µåœºï¼Œå®ç°å¯¹è½½æµå­è¿åŠ¨çš„æ§åˆ¶ã€‚äºŒæç®¡åˆ©ç”¨PNç»“çš„å•å‘å¯¼é€šç‰¹æ€§å®ç°æ•´æµåŠŸèƒ½ï¼Œæ˜¯ç”µå­ç”µè·¯ä¸­æœ€åŸºæœ¬çš„å™¨ä»¶ä¹‹ä¸€ã€‚</p>
                
                <p>æ™¶ä½“ç®¡æ˜¯ç°ä»£ç”µå­æŠ€æœ¯çš„æ ¸å¿ƒï¼ŒåŒææ™¶ä½“ç®¡(BJT)é€šè¿‡ç”µæµæ§åˆ¶å®ç°ä¿¡å·æ”¾å¤§ï¼Œè€ŒMOSFETé€šè¿‡ç”µå‹æ§åˆ¶å®ç°å¼€å…³å’Œæ”¾å¤§åŠŸèƒ½ã€‚ä¸åŒç±»å‹çš„æ™¶ä½“ç®¡å„æœ‰ä¼˜åŠ¿ï¼Œåœ¨æ•°å­—ç”µè·¯ã€æ¨¡æ‹Ÿç”µè·¯å’ŒåŠŸç‡ç”µå­ä¸­éƒ½æœ‰å¹¿æ³›åº”ç”¨ã€‚</p>
                
                <p>ç†è§£åŠå¯¼ä½“å™¨ä»¶çš„å·¥ä½œåŸç†éœ€è¦æŒæ¡è½½æµå­è¿åŠ¨ã€èƒ½å¸¦ç»“æ„å’Œç”µåœºåˆ†å¸ƒç­‰ç‰©ç†æ¦‚å¿µï¼Œè¿™äº›çŸ¥è¯†æ˜¯è®¾è®¡å’Œåˆ†æç”µå­ç”µè·¯çš„åŸºç¡€ã€‚ä¸‹ä¸€ç« å°†æ·±å…¥ä»‹ç»é›†æˆç”µè·¯çš„è®¾è®¡ä¸åˆ¶é€ ï¼Œå¸®åŠ©æ‚¨äº†è§£å¦‚ä½•å°†å•ä¸ªå™¨ä»¶é›†æˆä¸ºåŠŸèƒ½å¤æ‚çš„ç”µå­ç³»ç»Ÿã€‚</p>
            </div>
            
            <div class="subsection">
                <h4>ä¸‹ä¸€ç« é¢„å‘Š</h4>
                <p>ç¬¬4ç« å°†æ·±å…¥é›†æˆç”µè·¯çš„è®¾è®¡ä¸åˆ¶é€ ï¼Œå¸¦ä½ ç†è§£"å¦‚ä½•å°†æ•°ç™¾ä¸‡ä¸ªæ™¶ä½“ç®¡é›†æˆåœ¨ä¸€å—èŠ¯ç‰‡ä¸Šï¼Ÿ"ã€"é›†æˆç”µè·¯è®¾è®¡æµç¨‹æ˜¯æ€æ ·çš„ï¼Ÿ"ã€"åˆ¶é€ å·¥è‰ºå¦‚ä½•å½±å“å™¨ä»¶æ€§èƒ½ï¼Ÿ"ï¼Œå¹¶é€šè¿‡äº¤äº’å¼å·¥å…·ç›´è§‚æ„Ÿå—é›†æˆç”µè·¯çš„è®¾è®¡ä¸åˆ¶é€ è¿‡ç¨‹ã€‚</p>
                <button class="btn btn-primary" onclick="window.location.href='chapter4.html'">å‰å¾€ç¬¬4ç« </button>
            </div>
        </div>
    </main>
    
    <script src="../js/main.js"></script>
    <script>
        // è¿›åº¦è·Ÿè¸ª
        let junctionExperiments = 0;
        let testedDevices = [];
        let ivChart = null;
        
        // å™¨ä»¶ç‰¹æ€§æ•°æ®
        const deviceCharacteristics = {
            diode: {
                name: "äºŒæç®¡",
                element: "diode",
                ivFunction: function(v) {
                    // äºŒæç®¡çš„æŒ‡æ•°ç‰¹æ€§
                    const Is = 1e-12; // åå‘é¥±å’Œç”µæµ
                    const Vt = 0.026; // çƒ­ç”µå‹
                    const n = 1.5; // ç†æƒ³å› å­
                    
                    if (v < -0.5) {
                        return -Is * 1e6; // åå‘é¥±å’Œç”µæµï¼Œå•ä½Î¼A
                    } else {
                        return Is * (Math.exp(v / (n * Vt)) - 1) * 1e6; // æ­£å‘ç”µæµï¼Œå•ä½Î¼A
                    }
                }
            },
            bjt: {
                name: "åŒææ™¶ä½“ç®¡",
                element: "transistor",
                ivFunction: function(v) {
                    // ç®€åŒ–çš„BJTç‰¹æ€§
                    const Vbe = 0.7; // åŸºæ-å‘å°„æç”µå‹
                    const beta = 100; // ç”µæµæ”¾å¤§ç³»æ•°
                    
                    if (v < Vbe) {
                        return 0;
                    } else {
                        return beta * (v - Vbe) * 10; // é›†ç”µæç”µæµï¼Œå•ä½Î¼A
                    }
                }
            },
            mosfet: {
                name: "MOSFET",
                element: "transistor",
                ivFunction: function(v) {
                    // ç®€åŒ–çš„MOSFETç‰¹æ€§
                    const Vth = 1.0; // é˜ˆå€¼ç”µå‹
                    const k = 0.5; // è·¨å¯¼å‚æ•°
                    
                    if (v < Vth) {
                        return 0;
                    } else {
                        return k * (v - Vth) * (v - Vth) * 100; // æ¼æç”µæµï¼Œå•ä½Î¼A
                    }
                }
            }
        };
        
        // å½“å‰é€‰ä¸­çš„å™¨ä»¶
        let selectedDeviceType = null;
        
        // æ›´æ–°PNç»“æ¨¡æ‹Ÿ
        function updateJunction() {
            const pDoping = parseFloat(document.getElementById('p-doping').value);
            const nDoping = parseFloat(document.getElementById('n-doping').value);
            const biasVoltage = parseFloat(document.getElementById('bias-voltage').value);
            
            // æ›´æ–°æ˜¾ç¤ºå€¼
            document.getElementById('p-doping-value').textContent = `10^${pDoping} cmâ»Â³`;
            document.getElementById('n-doping-value').textContent = `10^${nDoping} cmâ»Â³`;
            document.getElementById('bias-voltage-value').textContent = `${biasVoltage.toFixed(1)} V`;
            
            // è®¡ç®—PNç»“ç‰¹æ€§
            const k = 1.38e-23; // ç»å°”å…¹æ›¼å¸¸æ•°
            const T = 300; // æ¸©åº¦ K
            const q = 1.6e-19; // ç”µå­ç”µè·
            const ni = 1.5e10; // æœ¬å¾è½½æµå­æµ“åº¦
            const epsilon = 11.7 * 8.85e-14; // ç¡…çš„ä»‹ç”µå¸¸æ•°
            
            // è®¡ç®—å†…å»ºç”µåŠ¿
            const Vbi = (k * T / q) * Math.log((Math.pow(10, pDoping) * Math.pow(10, nDoping)) / (ni * ni));
            
            // è®¡ç®—è€—å°½åŒºå®½åº¦
            const W = Math.sqrt(2 * epsilon / q * (1 / Math.pow(10, pDoping) + 1 / Math.pow(10, nDoping)) * (Vbi - biasVoltage));
            
            // è®¡ç®—ç»“ç”µå®¹
            const Cj = epsilon / W * 1e8; // å•ä½ pF/Î¼mÂ²
            
            // è®¡ç®—ç»“ç”µæµ
            let Ij;
            if (biasVoltage < 0) {
                // åå‘åç½®
                Ij = -1e-9; // åå‘é¥±å’Œç”µæµï¼Œå•ä½ A
            } else {
                // æ­£å‘åç½®
                const Is = 1e-12; // åå‘é¥±å’Œç”µæµ
                const Vt = k * T / q; // çƒ­ç”µå‹
                Ij = Is * (Math.exp(biasVoltage / Vt) - 1); // å•ä½ A
            }
            
            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('depletion-width').textContent = `${(W * 1e4).toFixed(2)} Î¼m`;
            document.getElementById('built-in-potential').textContent = `${Vbi.toFixed(2)} V`;
            document.getElementById('junction-capacitance').textContent = `${Cj.toFixed(2)} pF/Î¼mÂ²`;
            document.getElementById('junction-current').textContent = `${(Ij * 1e6).toFixed(2)} Î¼A`;
            
            // æ›´æ–°è€—å°½åŒºå¯è§†åŒ–
            const depletionRegion = document.getElementById('depletion-region');
            const depletionWidth = Math.max(10, Math.min(100, 40 + biasVoltage * 20));
            depletionRegion.style.width = `${depletionWidth}px`;
            
            // æ·»åŠ è½½æµå­åŠ¨ç”»
            addCarriers(biasVoltage);
            
            // è®°å½•è¿›åº¦
            if (junctionExperiments === 0) {
                junctionExperiments = 1;
                updateProgress();
            }
        }
        
        // æ·»åŠ è½½æµå­åŠ¨ç”»
        function addCarriers(biasVoltage) {
            const junctionViz = document.getElementById('junction-viz');
            
            // æ¸…é™¤ç°æœ‰è½½æµå­
            junctionViz.querySelectorAll('.charge-carrier').forEach(carrier => {
                carrier.remove();
            });
            
            // æ ¹æ®åç½®ç”µå‹æ·»åŠ è½½æµå­
            const carrierCount = Math.max(0, Math.min(10, Math.floor(biasVoltage * 3 + 5)));
            
            for (let i = 0; i < carrierCount; i++) {
                setTimeout(() => {
                    const isElectron = Math.random() > 0.5;
                    const carrier = document.createElement('div');
                    carrier.className = `charge-carrier ${isElectron ? 'electron' : 'hole'}`;
                    carrier.textContent = isElectron ? 'e-' : 'h+';
                    
                    // éšæœºä½ç½®
                    const left = Math.random() * 80 + 10; // 10% to 90%
                    const top = Math.random() * 80 + 10; // 10% to 90%
                    
                    carrier.style.left = `${left}%`;
                    carrier.style.top = `${top}%`;
                    
                    // éšæœºåŠ¨ç”»å»¶è¿Ÿå’ŒæŒç»­æ—¶é—´
                    carrier.style.animationDelay = `${Math.random() * 2}s`;
                    carrier.style.animationDuration = `${3 + Math.random() * 2}s`;
                    
                    junctionViz.appendChild(carrier);
                }, i * 200);
            }
        }
        
        // é€‰æ‹©å™¨ä»¶
        function selectDevice(deviceType) {
            // æ›´æ–°é€‰ä¸­çŠ¶æ€
            document.querySelectorAll('.device-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`.device-card[onclick="selectDevice('${deviceType}')"]`).classList.add('selected');
            
            // æ›´æ–°é€‰ä¸­çš„å™¨ä»¶
            selectedDeviceType = deviceType;
            const device = deviceCharacteristics[deviceType];
            
            // æ›´æ–°æµ‹è¯•ç”µè·¯
            updateTestCircuit(device);
            
            // åˆå§‹åŒ–IVæ›²çº¿
            initIVCurve(device);
            
            // è®°å½•è¿›åº¦
            if (!testedDevices.includes(deviceType)) {
                testedDevices.push(deviceType);
                updateProgress();
            }
        }
        
        // æ›´æ–°æµ‹è¯•ç”µè·¯
        function updateTestCircuit(device) {
            const testDevice = document.getElementById('test-device');
            
            // æ¸…é™¤ç°æœ‰ç±»
            testDevice.className = 'circuit-element';
            
            // æ·»åŠ å™¨ä»¶ç‰¹å®šçš„ç±»
            testDevice.classList.add(device.element);
            
            // æ›´æ–°æµ‹é‡æ˜¾ç¤º
            updateMeasurements(0);
        }
        
        // åˆå§‹åŒ–IVæ›²çº¿
        function initIVCurve(device) {
            const ctx = document.getElementById('iv-chart').getContext('2d');
            
            // é”€æ¯ç°æœ‰å›¾è¡¨
            if (ivChart) {
                ivChart.destroy();
            }
            
            // ç”Ÿæˆæ•°æ®ç‚¹
            const voltages = [];
            const currents = [];
            
            for (let v = -2; v <= 2; v += 0.1) {
                voltages.push(v);
                currents.push(device.ivFunction(v));
            }
            
            // åˆ›å»ºæ–°å›¾è¡¨
            ivChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: voltages,
                    datasets: [{
                        label: `${device.name} IVç‰¹æ€§`,
                        data: currents,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'ç”µå‹ (V)'
                            }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'ç”µæµ (Î¼A)'
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `ç”µæµ: ${context.parsed.y.toFixed(2)} Î¼A`;
                                }
                            }
                        }
                    }
                }
            });
            
            // æ·»åŠ äº¤äº’å¼ç”µå‹æ§åˆ¶
            addVoltageControl(device);
        }
        
        // æ·»åŠ ç”µå‹æ§åˆ¶
        function addVoltageControl(device) {
            const testArea = document.getElementById('device-test-area');
            
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç”µå‹æ§åˆ¶
            let voltageControl = document.getElementById('voltage-control');
            if (!voltageControl) {
                voltageControl = document.createElement('div');
                voltageControl.id = 'voltage-control';
                voltageControl.className = 'control-group';
                voltageControl.innerHTML = `
                    <label class="control-label">ç”µå‹æ§åˆ¶</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="device-voltage" min="-2" max="2" value="0" step="0.1" oninput="updateDeviceVoltage()">
                        <span class="slider-value" id="device-voltage-value">0.0 V</span>
                    </div>
                `;
                testArea.insertBefore(voltageControl, testArea.querySelector('.measurement-display'));
            }
            
            // æ›´æ–°ç”µå‹æ§åˆ¶äº‹ä»¶
            document.getElementById('device-voltage').oninput = function() {
                updateDeviceVoltage(device);
            };
        }
        
        // æ›´æ–°å™¨ä»¶ç”µå‹
        function updateDeviceVoltage(device) {
            const voltage = parseFloat(document.getElementById('device-voltage').value);
            document.getElementById('device-voltage-value').textContent = `${voltage.toFixed(1)} V`;
            
            // è®¡ç®—ç”µæµ
            const current = device ? device.ivFunction(voltage) : 0;
            
            // æ›´æ–°æµ‹é‡æ˜¾ç¤º
            updateMeasurements(voltage, current);
            
            // åœ¨IVå›¾è¡¨ä¸Šæ ‡è®°å½“å‰å·¥ä½œç‚¹
            if (ivChart) {
                ivChart.data.datasets.push({
                    label: 'å·¥ä½œç‚¹',
                    data: [{x: voltage, y: current}],
                    backgroundColor: '#e74c3c',
                    borderColor: '#e74c3c',
                    pointRadius: 5,
                    pointHoverRadius: 7,
                    showLine: false
                });
                ivChart.update();
            }
        }
        
        // æ›´æ–°æµ‹é‡æ˜¾ç¤º
        function updateMeasurements(voltage, current) {
            const power = voltage * current / 1000; // è½¬æ¢ä¸ºmW
            
            document.getElementById('voltage-value').textContent = `${voltage.toFixed(2)} V`;
            document.getElementById('current-value').textContent = `${current.toFixed(2)} Î¼A`;
            document.getElementById('power-value').textContent = `${power.toFixed(2)} mW`;
        }
        
        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            // æ›´æ–°PNç»“æ¨¡æ‹Ÿè¿›åº¦
            document.getElementById('junction-progress').textContent = `${junctionExperiments}/1`;
            
            // æ›´æ–°å™¨ä»¶æµ‹è¯•è¿›åº¦
            document.getElementById('device-progress').textContent = `${testedDevices.length}/${Object.keys(deviceCharacteristics).length}`;
            
            // ä¿å­˜è¿›åº¦
            saveProgress();
        }
        
        // ä¿å­˜è¿›åº¦
        function saveProgress() {
            const progress = {
                junctionExperiments,
                testedDevices,
                timestamp: Date.now()
            };
            localStorage.setItem('semiProj_chapter3_progress', JSON.stringify(progress));
        }
        
        // åŠ è½½è¿›åº¦
        function loadProgress() {
            const saved = localStorage.getItem('semiProj_chapter3_progress');
            if (saved) {
                const progress = JSON.parse(saved);
                junctionExperiments = progress.junctionExperiments || 0;
                testedDevices = progress.testedDevices || [];
                
                updateProgress();
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
            updateJunction();
        });
    </script>
</body>
</html>